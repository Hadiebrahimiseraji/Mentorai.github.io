<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MentorAI - Platform CXR</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #0066cc;
            --success: #00c853;
            --danger: #d32f2f;
            --warning: #ff6d00;
            --gray-800: #1f2937;
        }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: var(--gray-800); min-height: 100vh; }
        .login-container { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
        .login-card { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); width: 100%; max-width: 450px; padding: 3.5rem 2.5rem; text-align: center; }
        .login-icon { font-size: 5rem; margin-bottom: 1.5rem; }
        .login-card h1 { color: var(--primary); font-size: 2.5rem; margin-bottom: 0.5rem; font-weight: 700; }
        .login-card p { color: var(--gray-800); font-size: 1rem; margin-bottom: 2rem; }
        .form-group { margin-bottom: 1.5rem; text-align: right; }
        .form-group label { display: block; margin-bottom: 0.8rem; font-weight: 600; color: var(--gray-800); }
        .form-control { width: 100%; padding: 1rem; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 1rem; font-family: inherit; }
        .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.1); }
        .login-btn { width: 100%; padding: 1rem; background: linear-gradient(135deg, var(--primary) 0%, #0052a3 100%); color: white; border: none; border-radius: 10px; font-size: 1rem; font-weight: 700; cursor: pointer; }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 102, 204, 0.4); }
        .error-message { background: #ffebee; color: var(--danger); padding: 1rem; border-radius: 10px; margin-bottom: 1rem; border-left: 4px solid var(--danger); display: none; }
        .app-wrapper { display: none; background: #f8f9fa; min-height: 100vh; }
        .header { background: linear-gradient(135deg, var(--primary) 0%, #0052a3 100%); color: white; padding: 1.5rem 2rem; position: sticky; top: 0; z-index: 1000; }
        .header-content { max-width: 1600px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 2rem; font-weight: 800; }
        .logout-btn { background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid white; padding: 0.7rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.95rem; }
        .logout-btn:hover { background: white; color: var(--primary); }
        .container { max-width: 1600px; margin: 0 auto; padding: 2rem; }
        .progress-bar { width: 100%; height: 10px; background: #e5e7eb; border-radius: 10px; overflow: hidden; margin-bottom: 1rem; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--success)); transition: width 0.5s ease; }
        .main-grid { display: grid; grid-template-columns: 1.3fr 1fr; gap: 2rem; margin-bottom: 2rem; }
        @media (max-width: 1200px) { .main-grid { grid-template-columns: 1fr; } }
        .card { background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); }
        .card h2 { color: var(--primary); font-size: 1.5rem; margin-bottom: 1.5rem; }
        .clinical-section { background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); border: 2px solid var(--primary); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .clinical-item { margin-bottom: 1.2rem; }
        .clinical-label { font-weight: 700; color: var(--primary); margin-bottom: 0.5rem; font-size: 0.95rem; text-transform: uppercase; }
        .clinical-content { color: var(--gray-800); line-height: 1.8; font-size: 0.95rem; }
        .vitals-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 1rem; }
        .vital { background: white; padding: 1rem; border-radius: 10px; border-left: 4px solid var(--primary); text-align: center; }
        .vital-value { font-weight: 700; color: var(--primary); font-size: 1.2rem; }
        .vital-label { font-size: 0.8rem; color: var(--gray-800); }
        .image-viewer { background: #1f2937; border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem; }
        .image-container { position: relative; display: flex; align-items: center; justify-content: center; min-height: 500px; background: #1f2937; border-radius: 8px; overflow: hidden; }
        .image-wrapper { position: relative; display: inline-block; max-width: 100%; }
        .cxr-image { max-width: 100%; max-height: 500px; border-radius: 6px; display: block; filter: brightness(1); transition: transform 0.3s ease; }
        .heatmap-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 6px; display: none; pointer-events: none; }
        .image-tools { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.8rem; margin-bottom: 1.5rem; }
        .tool-btn { background: linear-gradient(135deg, #00a8e8 0%, var(--primary) 100%); color: white; border: none; padding: 0.8rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 600; }
        .tool-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3); }
        .tool-btn.active { background: linear-gradient(135deg, var(--success) 0%, #00a152 100%); }
        .slider-control { margin-bottom: 1rem; }
        .slider-label { font-size: 0.85rem; font-weight: 600; color: var(--gray-800); margin-bottom: 0.5rem; display: flex; justify-content: space-between; }
        input[type="range"] { width: 100%; height: 6px; border-radius: 3px; background: #e5e7eb; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: var(--primary); cursor: pointer; }
        .answer-section { display: none; }
        .answer-section.active { display: block; }
        .options-group { margin-bottom: 1.5rem; }
        .options-group label { display: block; margin-bottom: 1rem; font-weight: 600; color: var(--gray-800); }
        .option-item { display: flex; align-items: center; padding: 1rem; background: #f8f9fa; border: 2px solid #e5e7eb; border-radius: 10px; margin-bottom: 0.8rem; cursor: pointer; transition: all 0.3s ease; }
        .option-item:hover { background: #f3f4f6; border-color: var(--primary); transform: translateX(-5px); }
        .option-item input[type="radio"] { margin-left: 1rem; width: 20px; height: 20px; cursor: pointer; accent-color: var(--primary); }
        .option-label { flex: 1; cursor: pointer; color: var(--gray-800); font-weight: 500; }
        .form-label { display: block; margin-bottom: 0.8rem; font-weight: 600; color: var(--gray-800); }
        textarea { width: 100%; min-height: 100px; padding: 1rem; border: 2px solid #e5e7eb; border-radius: 10px; font-family: inherit; font-size: 0.95rem; }
        textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.1); }
        .btn { padding: 1rem 1.5rem; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, #0052a3 100%); color: white; width: 100%; margin-bottom: 1rem; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 102, 204, 0.4); }
        .btn-secondary { background: #f3f4f6; color: var(--gray-800); border: 2px solid #e5e7eb; width: 100%; }
        .feedback-section { display: none; animation: slideIn 0.5s ease; }
        .feedback-section.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .ai-insights { background: linear-gradient(135deg, #fff8e1 0%, #fff3e0 100%); border: 2px solid var(--warning); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .ai-insights h3 { color: #e65100; margin-bottom: 1rem; font-size: 1.1rem; }
        .insight-item { background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.8rem; border-right: 4px solid var(--warning); }
        .insight-title { font-weight: 700; color: #1f2937; margin-bottom: 0.4rem; }
        .insight-detail { color: var(--gray-800); font-size: 0.9rem; line-height: 1.6; }
        .teaching-box { background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border: 2px solid var(--success); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .teaching-box h4 { color: #2e7d32; margin-bottom: 1rem; }
        .teaching-content { color: var(--gray-800); font-size: 0.95rem; white-space: pre-wrap; }
        .explainability-note { background: #e3f2fd; border-left: 4px solid var(--primary); padding: 1rem; border-radius: 8px; font-size: 0.85rem; color: #1565c0; margin-bottom: 1rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .stat-box { background: linear-gradient(135deg, #f5f7fa 0%, #e8eef2 100%); padding: 1.5rem; border-radius: 10px; text-align: center; border-top: 3px solid var(--primary); }
        .stat-value { font-size: 1.8rem; font-weight: 700; color: var(--primary); margin-bottom: 0.4rem; }
        .stat-label { font-size: 0.8rem; color: var(--gray-800); font-weight: 600; text-transform: uppercase; }
        .summary-panel { background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); display: none; }
        .summary-panel.active { display: block; }
    </style>
</head>
<body>
    <div class="login-container" id="loginPage">
        <div class="login-card">
            <div class="login-icon">ğŸ¥</div>
            <h1>MentorAI</h1>
            <p>Ù¾Ù„ØªÙØ±Ù… ØªÙØ³ÛŒØ± Ø±Ø§Ø¯ÛŒÙˆÚ¯Ø±Ø§ÙÛŒ Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</p>
            <div class="error-message" id="errorMessage"></div>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                    <input type="text" id="username" class="form-control" placeholder="" required>
                </div>
                <div class="form-group">
                    <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                    <input type="password" id="password" class="form-control" placeholder="..." required>
                </div>
                <button type="submit" class="login-btn">ğŸ” ÙˆØ±ÙˆØ¯</button>
            </form>
        </div>
    </div>

    <div class="app-wrapper" id="appWrapper">
        <header class="header">
            <div class="header-content">
                <div class="logo">ğŸ¥ MentorAI</div>
                <button class="logout-btn" onclick="handleLogout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
            </div>
        </header>

        <div class="container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div style="text-align: left; margin-bottom: 2rem; font-weight: 600; color: #1f2937;">Ù…ÙˆØ±Ø¯ <strong id="caseNum">1</strong> Ø§Ø² <strong id="totalCases">5</strong></div>

            <div class="main-grid">
                <div>
                    <div class="card" id="questionCard">
                        <h2 id="caseTitle"></h2>
                        <div class="clinical-section">
                            <div class="clinical-item">
                                <div class="clinical-label">ğŸ”´ Ø´Ú©Ø§ÛŒØª Ø§ØµÙ„ÛŒ</div>
                                <div class="clinical-content" id="chiefComplaint"></div>
                            </div>
                            <div class="clinical-item">
                                <div class="clinical-label">ğŸ“ ØªØ§Ø±ÛŒØ® Ø¨ÛŒÙ…Ø§Ø±ÛŒ</div>
                                <div class="clinical-content" id="hpi"></div>
                            </div>
                            <div class="clinical-item">
                                <div class="clinical-label">ğŸ“Š Ø¹Ù„Ø§Ø¦Ù… Ø­ÛŒØ§ØªÛŒ</div>
                                <div class="vitals-grid" id="vitals"></div>
                            </div>
                            <div class="clinical-item">
                                <div class="clinical-label">ğŸ©º Ù…Ø¹Ø§ÛŒÙ†Ù‡ ÙÛŒØ²ÛŒÚ©ÛŒ</div>
                                <div class="clinical-content" id="pe"></div>
                            </div>
                        </div>

                        <div class="image-viewer">
                            <div class="image-tools">
                                <button class="tool-btn" onclick="toggleHeatmap()" id="heatmapBtn">ğŸ”¥ Grad-CAM</button>
                                <button class="tool-btn" onclick="zoomIn()">ğŸ”+ Ø¨Ø²Ø±Ú¯</button>
                                <button class="tool-btn" onclick="zoomOut()">ğŸ”- Ú©ÙˆÚ†Ú©</button>
                            </div>
                            <div class="slider-control" id="opacityControl" style="display:none;">
                                <div class="slider-label">
                                    <span>ğŸ” Ø´ÙØ§ÙÛŒØª</span>
                                    <span id="opacityValue">60%</span>
                                </div>
                                <input type="range" id="opacity" min="0" max="100" value="60" onchange="updateOpacity()">
                            </div>
                            <div class="slider-control">
                                <div class="slider-label">
                                    <span>ğŸ’¡ Ø±ÙˆØ´Ù†Ø§ÛŒÛŒ</span>
                                    <span id="brightnessValue">100%</span>
                                </div>
                                <input type="range" id="brightness" min="50" max="150" value="100" onchange="updateImage()">
                            </div>
                            <div class="image-container">
                                <div class="image-wrapper">
                                    <img id="cxrImage" class="cxr-image" src="" alt="CXR" crossorigin="anonymous" onload="onImageLoad()" onerror="onImageError()">
                                    <canvas id="heatmapCanvas" class="heatmap-overlay"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="card answer-section active" id="answerCard">
                        <h2>âœ… ØªØ´Ø®ÛŒØµ Ùˆ ØªÙØ³ÛŒØ±</h2>
                        <div class="options-group">
                            <label>ğŸ¥ ØªØ´Ø®ÛŒØµ Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ:</label>
                            <div id="optionsContainer"></div>
                        </div>
                        <div class="answer-form">
                            <label class="form-label">ğŸ’¬ ØªÙˆØ¶ÛŒØ­Ø§Øª Ùˆ ÛŒØ§ÙØªÙ‡â€ŒÙ‡Ø§:</label>
                            <textarea id="answerText" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª ÛŒØ§ÙØªÙ‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="submitAnswer()">âœ“ Ø«Ø¨Øª Ù¾Ø§Ø³Ø®</button>
                        <button class="btn btn-secondary" onclick="resetAnswer()">â†» Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
                    </div>

                    <div class="feedback-section" id="feedbackCard">
                        <div class="explainability-note">
                            ğŸ” <strong>ØªÙˆØ¶ÛŒØ­ Grad-CAM:</strong> Ø§ÛŒÙ† Ù†Ù‚Ø´Ù‡ ØªØ´Ø®ÛŒØµ Ù‚Ø·Ø¹ÛŒ Ù†ÛŒØ³ØªØŒ Ø¨Ù„Ú©Ù‡ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ù…Ø¯Ù„ Ø¨Ù‡ Ú©Ø¯Ø§Ù… Ù†ÙˆØ§Ø­ÛŒ ØªÙˆØ¬Ù‡ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª.
                        </div>
                        <div class="card">
                            <div class="ai-insights">
                                <h3>ğŸ¤– ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ AI - Ù†Ú©Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ</h3>
                                <div id="aiInsights"></div>
                            </div>
                            <div class="teaching-box">
                                <h4>ğŸ“š Ù†Ú©Ø§Øª Ø¢Ù…ÙˆØ²Ø´ÛŒ</h4>
                                <div class="teaching-content" id="teaching"></div>
                            </div>
                            <div class="stats-grid">
                                <div class="stat-box">
                                    <div class="stat-value" id="accuracyScore">-</div>
                                    <div class="stat-label">Ø¯Ù‚Øª %</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-value" id="timeScore">-</div>
                                    <div class="stat-label">Ø²Ù…Ø§Ù† (Ø«Ø§)</div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="nextCase()">â†’ Ù…ÙˆØ±Ø¯ Ø¨Ø¹Ø¯ÛŒ</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="summary-panel" id="summaryPanel">
                <h2>ğŸ‰ Ø®Ø§ØªÙ…Ù‡ Ø¢Ø²Ù…ÙˆÙ†!</h2>
                <div class="stats-grid" style="margin-top: 1.5rem;">
                    <div class="stat-box">
                        <div class="stat-value" id="totalCasesCompleted">-</div>
                        <div class="stat-label">Ù…ÙˆØ§Ø±Ø¯ ØªÚ©Ù…ÛŒÙ„â€ŒØ´Ø¯Ù‡</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avgAccuracy">-</div>
                        <div class="stat-label">Ø¯Ù‚Øª Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="totalTime">-</div>
                        <div class="stat-label">Ø²Ù…Ø§Ù† Ú©Ù„</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const users = {
            'pilot2025': { password: 'pilot2025' }
        };

        const optionsPerCase = {
            normal: { correct: 'normal', options: [
                {id: 'normal', label: 'Ø·Ø¨ÛŒØ¹ÛŒ'},
                {id: 'pneumonia', label: 'Ù¾Ù†ÙˆÙ…ÙˆÙ†ÛŒ Ø±ÛŒÙ‡'},
                {id: 'asthma', label: 'Ø¢Ø³Ù…'},
                {id: 'atelectasis', label: 'Ø¢ØªÙ„Ú©ØªØ§Ø²ÛŒ'}
            ]},
            pneumonia: { correct: 'pneumonia', options: [
                {id: 'pneumonia', label: 'Ù¾Ù†ÙˆÙ…ÙˆÙ†ÛŒ Ø±ÛŒÙ‡'},
                {id: 'normal', label: 'Ù‚ÙØ³Ù‡ Ø·Ø¨ÛŒØ¹ÛŒ'},
                {id: 'tb', label: 'Ø³Ù„'},
                {id: 'carcinoma', label: 'Ú©Ø§Ø±Ø³ÛŒÙ†ÙˆÙ…'}
            ]},
            pneumothorax: { correct: 'pneumothorax', options: [
                {id: 'pneumothorax', label: 'Ù¾Ù†ÙˆÙ…ÙˆØªÙˆØ±Ø§Ú©Ø³'},
                {id: 'pleural_effusion', label: 'Ø§ÙÛŒÙˆÚ˜Ù† Ù¾Ù„ÙˆØ±Ø§Ù„'},
                {id: 'normal', label: 'Ø·Ø¨ÛŒØ¹ÛŒ'},
                {id: 'hemothorax', label: 'Ù‡Ù…ÙˆØªÙˆØ±Ø§Ú©Ø³'}
            ]},
            'pleural-effusion': { correct: 'pleural_effusion', options: [
                {id: 'pleural_effusion', label: 'Ø§ÙÛŒÙˆÚ˜Ù† Ù¾Ù„ÙˆØ±Ø§Ù„'},
                {id: 'pneumothorax', label: 'Ù¾Ù†ÙˆÙ…ÙˆØªÙˆØ±Ø§Ú©Ø³'},
                {id: 'hernia', label: 'ÙØªÙ‚ Ø¯ÛŒØ§ÙØ±Ø§Ú¯Ù…'},
                {id: 'collapse', label: 'ÙØ±ÙˆÙ¾Ø§Ø´ÛŒ'}
            ]},
            cardiomegaly: { correct: 'cardiomegaly', options: [
                {id: 'cardiomegaly', label: 'Ú©Ø§Ø±Ø¯ÛŒÙˆÙ…Ú¯Ø§Ù„ÛŒ'},
                {id: 'pericardial', label: 'Ø§ÙÛŒÙˆÚ˜Ù† Ù¾Ø±ÛŒÚ©Ø§Ø±Ø¯ÛŒØ§Ù„'},
                {id: 'normal', label: 'Ø·Ø¨ÛŒØ¹ÛŒ'},
                {id: 'mediastinal', label: 'ØªÙˆØ¯Ù‡ Ù…Ø¯ÛŒØ§Ø³ØªÙ†'}
            ]}
        };

        const clinicalData = {
            normal: {
                title: 'Ù…ÙˆØ±Ø¯ 1: Ù‚ÙØ³Ù‡ Ø³ÛŒÙ†Ù‡ Ø·Ø¨ÛŒØ¹ÛŒ',
                chief_complaint: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ø³Ù„Ø§Ù…Øª',
                hpi: 'Ø¨ÛŒÙ…Ø§Ø± 25 Ø³Ø§Ù„Ù‡ØŒ Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ø¦Ù… ØªÙ†ÙØ³ÛŒØŒ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ø¨Ø±Ø§ÛŒ Ú†Ú©â€ŒØ¢Ù¾ Ù…Ø¹Ù…ÙˆÙ„',
                vitals: [{label:'Ø¯Ù…Ø§', value:'36.5Â°C'}, {label:'Ø¶Ø±Ø¨Ø§Ù†', value:'72'}, {label:'ØªÙ†ÙØ³', value:'16'}, {label:'ÙØ´Ø§Ø±', value:'120/80'}, {label:'Ø§Ú©Ø³ÛŒÚ˜Ù†', value:'98%'}],
                pe: 'Ù…Ø¹Ø§ÛŒÙ†Ù‡ ÙÛŒØ²ÛŒÚ©ÛŒ Ø·Ø¨ÛŒØ¹ÛŒØŒ ØµØ¯Ø§Ù‡Ø§ÛŒ ØªÙ†ÙØ³ÛŒ ÙˆØ§Ø¶Ø­ Ø¯Ø± ØªÙ…Ø§Ù… Ù‚Ø³Ù…Øªâ€ŒÙ‡Ø§',
                image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a1/Normal_posteroanterior_%28PA%29_chest_radiograph_%28X-ray%29.jpg/512px-Normal_posteroanterior_%28PA%29_chest_radiograph_%28X-ray%29.jpg',
                insights: [{title: 'âœ“ Ù¾Ø§Ø±Ø§Ù†Ø´ÛŒÙ… Ø±ÛŒÙˆÛŒ', detail: 'Ø´ÙØ§Ù Ùˆ Ø¨Ø¯ÙˆÙ† Ø§ÛŒÙ†ÙÛŒÙ„ØªØ±Ø§Ø³ÛŒÙˆÙ†'}, {title: 'âœ“ Ø³Ø§ÛŒÙ‡ Ù‚Ù„Ø¨ÛŒ', detail: 'CTR Ú©Ù…ØªØ± Ø§Ø² 0.5 (Ø·Ø¨ÛŒØ¹ÛŒ)'}, {title: 'âœ“ Ø¯ÛŒØ§ÙØ±Ø§Ú¯Ù…', detail: 'Ø®Ø·ÙˆØ· ÙˆØ§Ø¶Ø­ Ùˆ Ø¯Ø± Ù…ÙˆÙ‚Ø¹ÛŒØª Ø·Ø¨ÛŒØ¹ÛŒ'}],
                teaching: 'âœ… ÛŒØ§ÙØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø·Ø¨ÛŒØ¹ÛŒ CXR:\nâ€¢ Ø±ÛŒÙ‡â€ŒÙ‡Ø§ Ø´ÙØ§Ù Ø¨Ø¯ÙˆÙ† Ø§ÛŒÙ†ÙÛŒÙ„ØªØ±Ø§Ø³ÛŒÙˆÙ†\nâ€¢ Ù‚Ù„Ø¨ Ø¯Ø± Ø§Ù†Ø¯Ø§Ø²Ù‡ Ùˆ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø·Ø¨ÛŒØ¹ÛŒ\nâ€¢ Ø¯ÛŒØ§ÙØ±Ø§Ú¯Ù… Ù…Ø´Ø®Øµ Ùˆ Ø¯Ø± Ø¬Ø§ÛŒ Ø®ÙˆØ¯\nâ€¢ Ù‡ÛŒÙ„ÙˆÙ…â€ŒÙ‡Ø§ Ø¯Ø± Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø·Ø¨ÛŒØ¹ÛŒ'
            },
            pneumonia: {
                title: 'Ù…ÙˆØ±Ø¯ 2: Ù¾Ù†ÙˆÙ…ÙˆÙ†ÛŒ Ø±ÛŒÙ‡',
                chief_complaint: 'ØªØ¨ØŒ Ø³Ø±ÙÙ‡ Ø¨Ø§ Ø®Ù„Ø·ØŒ ØªÙ†Ú¯ÛŒ Ù†ÙØ³',
                hpi: 'Ø¨ÛŒÙ…Ø§Ø± 40 Ø³Ø§Ù„Ù‡ Ø¨Ø§ ØªØ¨ 38.5 Ø¯Ø±Ø¬Ù‡ØŒ Ø³Ø±ÙÙ‡ Ù…ÙˆÙ„Ø¯ Ùˆ ØªÙ†Ú¯ÛŒ Ù†ÙØ³ Ø§Ø² 3 Ø±ÙˆØ² Ù¾ÛŒØ´',
                vitals: [{label:'Ø¯Ù…Ø§', value:'38.5Â°C'}, {label:'Ø¶Ø±Ø¨Ø§Ù†', value:'105'}, {label:'ØªÙ†ÙØ³', value:'24'}, {label:'ÙØ´Ø§Ø±', value:'130/85'}, {label:'Ø§Ú©Ø³ÛŒÚ˜Ù†', value:'92%'}],
                pe: 'Ú©Ø±Ø§Ú©Ù„ Ø¯Ø± Ù„ÙˆØ¨ ØªØ­ØªØ§Ù†ÛŒ Ø±Ø§Ø³ØªØŒ ØªØ§Ú©ÛŒâ€ŒÙ¾Ù†Ù‡ØŒ Ú©Ø§Ù‡Ø´ ØµØ¯Ø§Ù‡Ø§ÛŒ ØªÙ†ÙØ³ÛŒ',
                image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/01/Pneumonia_x_ray.jpg/512px-Pneumonia_x_ray.jpg',
                insights: [{title: 'âš  Ú©Ø§Ù†Ø³ÙˆÙ„ÛŒØ¯Ø§Ø³ÛŒÙˆÙ†', detail: 'Ø§ÙˆÙ¾Ø§Ø³ÛŒØªÙ‡ Ù…ØªÙ…Ø±Ú©Ø² Ø¯Ø± Ù„ÙˆØ¨ ØªØ­ØªØ§Ù†ÛŒ'}, {title: 'âš  Air Bronchogram', detail: 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¨Ø±ÙˆÙ†Ø´ÛŒÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ§ÛŒÛŒ Ø¯Ø± Ø²Ù…ÛŒÙ†Ù‡ Ù…ØªØ±Ø§Ú©Ù…'}, {title: 'âš  Ø¹Ù„Ø§Ø¦Ù… Ú©Ù„ÛŒÙ†ÛŒÚ©ÛŒ', detail: 'ØªØ¨ + Ú©Ø±Ø§Ú©Ù„ + Ù„Ú©ÙˆØ³ÛŒØªÙˆØ²'}],
                teaching: 'âš  Ù¾Ù†ÙˆÙ…ÙˆÙ†ÛŒ Ø¨Ø§Ú©ØªØ±ÛŒØ§Ù„:\nâ€¢ Ú©Ø§Ù†Ø³ÙˆÙ„ÛŒØ¯Ø§Ø³ÛŒÙˆÙ† Ù„ÙˆØ¨Ø§Ø±\nâ€¢ Air bronchogram Ù…Ø«Ø¨Øª\nâ€¢ Ù‡Ù…Ø±Ø§Ù‡ÛŒ Ø¨Ø§ ØªØ¨ Ùˆ Ù„Ú©ÙˆØ³ÛŒØªÙˆØ²\nâ€¢ Ø¯Ø±Ù…Ø§Ù† Ø¨Ø§ Ø¢Ù†ØªÛŒâ€ŒØ¨ÛŒÙˆØªÛŒÚ© Ú¯Ø³ØªØ±Ø¯Ù‡'
            },
            pneumothorax: {
                title: 'Ù…ÙˆØ±Ø¯ 3: Ù¾Ù†ÙˆÙ…ÙˆØªÙˆØ±Ø§Ú©Ø³',
                chief_complaint: 'Ø¯Ø±Ø¯ Ù‚ÙØ³Ù‡ Ø³ÛŒÙ†Ù‡ Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒØŒ ØªÙ†Ú¯ÛŒ Ù†ÙØ³ Ø´Ø¯ÛŒØ¯',
                hpi: 'Ø¨ÛŒÙ…Ø§Ø± 28 Ø³Ø§Ù„Ù‡ Ø¨Ø§ Ø´Ø±ÙˆØ¹ Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ Ø¯Ø±Ø¯ Ù‚ÙØ³Ù‡ Ø³ÛŒÙ†Ù‡ Ùˆ ØªÙ†Ú¯ÛŒ Ù†ÙØ³',
                vitals: [{label:'Ø¯Ù…Ø§', value:'37.2Â°C'}, {label:'Ø¶Ø±Ø¨Ø§Ù†', value:'110'}, {label:'ØªÙ†ÙØ³', value:'26'}, {label:'ÙØ´Ø§Ø±', value:'128/82'}, {label:'Ø§Ú©Ø³ÛŒÚ˜Ù†', value:'94%'}],
                pe: 'Ú©Ø§Ù‡Ø´ Ø´Ø¯ÛŒØ¯ ØµØ¯Ø§Ù‡Ø§ÛŒ ØªÙ†ÙØ³ÛŒ Ø¯Ø± Ù†ÛŒÙ…Ù‡ Ø±Ø§Ø³ØªØŒ ØªØ§Ú©ÛŒâ€ŒÙ¾Ù†Ù‡ØŒ ØªØ§Ú©ÛŒâ€ŒÚ©Ø§Ø±Ø¯ÛŒ',
                image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Pneumothorax_CXR.jpg/512px-Pneumothorax_CXR.jpg',
                insights: [{title: 'ğŸ”´ Ø®Ø· Ù¾Ù„ÙˆØ±Ø§Ù„', detail: 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø®Ø· ÙˆØ§Ø¶Ø­ ÙˆÛŒØ³Ø±Ø§Ù„ Ù¾Ù„ÙˆØ±Ø§'}, {title: 'ğŸ”´ ÙØ±ÙˆÙ¾Ø§Ø´ÛŒ Ø±ÛŒÙ‡', detail: 'Ø±ÛŒÙ‡ Ú©ÙˆÙ„Ù¾Ø³ Ø´Ø¯Ù‡ Ø¨Ù‡ Ø³Ù…Øª Ù‡ÛŒÙ„ÙˆÙ…'}, {title: 'ğŸ”´ Ø¹Ø¯Ù… Ù…Ø§Ø±Ú©ÛŒÙ†Ú¯', detail: 'ÙØ¶Ø§ÛŒ Ø¨Ø¯ÙˆÙ† Ù…Ø§Ø±Ú©ÛŒÙ†Ú¯ Ø¹Ø±ÙˆÙ‚ÛŒ'}],
                teaching: 'ğŸ”´ Ù¾Ù†ÙˆÙ…ÙˆØªÙˆØ±Ø§Ú©Ø³:\nâ€¢ Ø®Ø· ÙˆÛŒØ³Ø±Ø§Ù„ Ù¾Ù„ÙˆØ±Ø§ Ù…Ø´Ø®Øµ\nâ€¢ ÙØ±ÙˆÙ¾Ø§Ø´ÛŒ Ø±ÛŒÙ‡ Ø¨Ù‡ Ø³Ù…Øª Ù‡ÛŒÙ„ÙˆÙ…\nâ€¢ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø§Ø±Ú©ÛŒÙ†Ú¯ Ø¹Ø±ÙˆÙ‚ÛŒ Ø¯Ø± ÙØ¶Ø§ÛŒ Ù¾Ù†ÙˆÙ…ÙˆØªÙˆØ±Ø§Ú©Ø³\nâ€¢ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ú†Ø³Øª ØªÛŒÙˆØ¨ Ø¯Ø± Ù…ÙˆØ§Ø±Ø¯ Ø´Ø¯ÛŒØ¯'
            },
            'pleural-effusion': {
                title: 'Ù…ÙˆØ±Ø¯ 4: Ø§ÙÛŒÙˆÚ˜Ù† Ù¾Ù„ÙˆØ±Ø§Ù„',
                chief_complaint: 'ØªÙ†Ú¯ÛŒ Ù†ÙØ³ ØªØ¯Ø±ÛŒØ¬ÛŒØŒ Ø§Ø­Ø³Ø§Ø³ Ø³Ù†Ú¯ÛŒÙ†ÛŒ Ù‚ÙØ³Ù‡ Ø³ÛŒÙ†Ù‡',
                hpi: 'Ø¨ÛŒÙ…Ø§Ø± 55 Ø³Ø§Ù„Ù‡ Ø¨Ø§ Ø³Ø§Ø¨Ù‚Ù‡ Ù†Ø§Ø±Ø³Ø§ÛŒÛŒ Ø§Ø­ØªÙ‚Ø§Ù†ÛŒ Ù‚Ù„Ø¨ØŒ ØªÙ†Ú¯ÛŒ Ù†ÙØ³ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØªÙ‡',
                vitals: [{label:'Ø¯Ù…Ø§', value:'37.0Â°C'}, {label:'Ø¶Ø±Ø¨Ø§Ù†', value:'98'}, {label:'ØªÙ†ÙØ³', value:'22'}, {label:'ÙØ´Ø§Ø±', value:'140/90'}, {label:'Ø§Ú©Ø³ÛŒÚ˜Ù†', value:'93%'}],
                pe: 'Ú©Ø§Ù‡Ø´ Ø´Ù†ÙˆØ§ÛŒÛŒ Ø¯Ø± Ù‚Ø§Ø¹Ø¯Ù‡ Ø±ÛŒÙ‡ Ú†Ù¾ØŒ Ø¨Ø±Ø§Ù†Ø´ Ù…Ù†ÛŒØ³Ú©ÙˆØ³',
                image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Pleural_effusion.jpg/512px-Pleural_effusion.jpg',
                insights: [{title: 'âš  Blunting Ú©ÙˆØ³ØªÙˆÙØ±Ù†ÛŒÚ©', detail: 'Ù…Ø­Ùˆ Ø´Ø¯Ù† Ø²Ø§ÙˆÛŒÙ‡ Ú©ÙˆØ³ØªÙˆÙØ±Ù†ÛŒÚ©'}, {title: 'âš  Ø¹Ù„Ø§Ù…Øª Ù…Ù†ÛŒØ³Ú©ÙˆØ³', detail: 'Ø³Ø§ÛŒÙ‡ Ù…Ø§ÛŒØ¹ Ø¨Ø§ Ø®Ø· Ù…Ù†Ø­Ù†ÛŒ Ù…Ø´Ø®Øµ'}, {title: 'âš  Ù…Ø§ÛŒØ¹ Ù¾Ù„ÙˆØ±Ø§Ù„', detail: 'Ø¬Ù…Ø¹ Ø´Ø¯Ù† Ù…Ø§ÛŒØ¹ Ø¯Ø± ÙØ¶Ø§ÛŒ Ù¾Ù„ÙˆØ±Ø§Ù„'}],
                teaching: 'âš  Ø§ÙÛŒÙˆÚ˜Ù† Ù¾Ù„ÙˆØ±Ø§Ù„:\nâ€¢ Blunting Ø²Ø§ÙˆÛŒÙ‡ Ú©ÙˆØ³ØªÙˆÙØ±Ù†ÛŒÚ©\nâ€¢ Ø¹Ù„Ø§Ù…Øª Ù…Ù†ÛŒØ³Ú©ÙˆØ³\nâ€¢ Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒ Light Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø§Ú¯Ø²ÙˆØ¯Ø§/ØªØ±Ø§Ù†Ø³ÙˆØ¯Ø§\nâ€¢ Ø¶Ø±ÙˆØ±Øª ØªØ§Ø±Ø§Ø³Ù†ØªØ² Ø¯Ø± Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø²Ø±Ú¯'
            },
            cardiomegaly: {
                title: 'Ù…ÙˆØ±Ø¯ 5: Ú©Ø§Ø±Ø¯ÛŒÙˆÙ…Ú¯Ø§Ù„ÛŒ',
                chief_complaint: 'Ø®Ø³ØªÚ¯ÛŒ Ù…Ø²Ù…Ù†ØŒ ØªÙ†Ú¯ÛŒ Ù†ÙØ³ Ø¨Ø§ ÙØ¹Ø§Ù„ÛŒØª',
                hpi: 'Ø¨ÛŒÙ…Ø§Ø± 60 Ø³Ø§Ù„Ù‡ Ø¨Ø§ Ø³Ø§Ø¨Ù‚Ù‡ ÙØ´Ø§Ø± Ø®ÙˆÙ† Ú©Ù†ØªØ±Ù„ Ù†Ø´Ø¯Ù‡ØŒ Ø®Ø³ØªÚ¯ÛŒ Ùˆ ØªÙ†Ú¯ÛŒ Ù†ÙØ³',
                vitals: [{label:'Ø¯Ù…Ø§', value:'37.1Â°C'}, {label:'Ø¶Ø±Ø¨Ø§Ù†', value:'92'}, {label:'ØªÙ†ÙØ³', value:'20'}, {label:'ÙØ´Ø§Ø±', value:'155/95'}, {label:'Ø§Ú©Ø³ÛŒÚ˜Ù†', value:'95%'}],
                pe: 'Ø³ÙˆÙÙ„ Ø³ÛŒØ³ØªÙˆÙ„ÛŒÚ©ØŒ Ù†Ø¨Ø¶ Ù…Ø­ÛŒØ·ÛŒ Ø¶Ø¹ÛŒÙØŒ Ø§Ø¯Ù… Ù¾Ø§ Ø¯ÙˆØ·Ø±ÙÙ‡',
                image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/7a/Cardiomegally.PNG/512px-Cardiomegally.PNG',
                insights: [{title: 'ğŸ”´ Ù†Ø³Ø¨Øª CTR', detail: 'CTR Ø¨ÛŒØ´ØªØ± Ø§Ø² 0.5 (Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØªÙ‡)'}, {title: 'ğŸ”´ Ø¨Ø²Ø±Ú¯ÛŒ Ù‚Ù„Ø¨', detail: 'Ø§ÙØ²Ø§ÛŒØ´ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø³Ø§ÛŒÙ‡ Ù‚Ù„Ø¨ÛŒ'}, {title: 'ğŸ”´ ØªØºÛŒÛŒØ± Ø³ÛŒÙ„ÙˆØ¦Øª', detail: 'ØªØºÛŒÛŒØ± Ø´Ú©Ù„ Ùˆ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù‚Ù„Ø¨'}],
                teaching: 'ğŸ”´ Ú©Ø§Ø±Ø¯ÛŒÙˆÙ…Ú¯Ø§Ù„ÛŒ:\nâ€¢ CTR Ø¨ÛŒØ´ØªØ± Ø§Ø² 0.5\nâ€¢ Ø§ÙØ²Ø§ÛŒØ´ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø³Ø§ÛŒÙ‡ Ù‚Ù„Ø¨ÛŒ\nâ€¢ Ø§Ø­ØªÙ…Ø§Ù„ Ú©Ø§Ø±Ø¯ÛŒÙˆÙ…ÛŒÙˆÙ¾Ø§ØªÛŒ Ø¯ÛŒÙ„Ø§ØªÙ‡\nâ€¢ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ú©ÙˆÚ©Ø§Ø±Ø¯ÛŒÙˆÚ¯Ø±Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ù‚ÛŒÙ‚'
            }
        };

        let currentUser = null, caseIndex = 0, responses = [], startTime = null, zoomLevel = 1, showingHeatmap = false, selectedOption = null, maxCases = 5;
        const caseOrder = ['normal', 'pneumonia', 'pneumothorax', 'pleural-effusion', 'cardiomegaly'];

        function handleLogin(e) {
            e.preventDefault();
            const u = document.getElementById('username').value, p = document.getElementById('password').value, err = document.getElementById('errorMessage');
            if (users[u] && users[u].password === p) {
                currentUser = u;
                maxCases = 5;
                document.getElementById('totalCases').textContent = maxCases;
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('appWrapper').style.display = 'block';
                loadCase();
            } else {
                err.style.display = 'block';
                err.textContent = 'âŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª';
            }
        }

        function handleLogout() { if (confirm('Ø§Ø² Ø®Ø±ÙˆØ¬ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) location.reload(); }

        function onImageLoad() {
            console.log('Image loaded successfully');
        }

        function onImageError() {
            console.error('Failed to load image');
            alert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ±. Ù„Ø·ÙØ§ Ù…Ø¬Ø¯Ø¯Ø§ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
        }

        function loadCase() {
            if (caseIndex >= maxCases) { showSummary(); return; }
            const caseId = caseOrder[caseIndex], data = clinicalData[caseId], opts = optionsPerCase[caseId];
            startTime = Date.now(); selectedOption = null;
            document.getElementById('caseNum').textContent = caseIndex + 1;
            document.getElementById('caseTitle').textContent = data.title;
            document.getElementById('chiefComplaint').textContent = data.chief_complaint;
            document.getElementById('hpi').textContent = data.hpi;
            document.getElementById('pe').textContent = data.pe;
            document.getElementById('vitals').innerHTML = data.vitals.map(v => `<div class="vital"><div class="vital-value">${v.value}</div><div class="vital-label">${v.label}</div></div>`).join('');
            document.getElementById('optionsContainer').innerHTML = opts.options.map(opt => `<div class="option-item" onclick="selectOption('${opt.id}', event)"><input type="radio" name="diagnosis" value="${opt.id}"><label class="option-label">${opt.label}</label></div>`).join('');
            const img = document.getElementById('cxrImage');
            img.src = data.image; img.style.transform = 'scale(1)'; zoomLevel = 1;
            document.getElementById('brightness').value = 100;
            updateImage();
            document.getElementById('answerText').value = '';
            document.getElementById('questionCard').style.display = 'block';
            document.getElementById('answerCard').classList.add('active');
            document.getElementById('feedbackCard').classList.remove('active');
            document.getElementById('heatmapBtn').textContent = 'ğŸ”¥ Grad-CAM';
            document.getElementById('heatmapCanvas').style.display = 'none';
            document.getElementById('opacityControl').style.display = 'none';
            showingHeatmap = false;
            updateProgress();
        }

        function selectOption(id, e) {
            selectedOption = id;
            document.querySelectorAll('input[name="diagnosis"]').forEach(el => el.checked = false);
            e.currentTarget.querySelector('input[type="radio"]').checked = true;
        }

        function submitAnswer() {
            if (!selectedOption) { alert('Ù„Ø·ÙØ§ ÛŒÚ© Ú¯Ø²ÛŒÙ†Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯'); return; }
            const answer = document.getElementById('answerText').value.trim();
            if (!answer) { alert('Ù„Ø·ÙØ§ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯'); return; }
            const caseId = caseOrder[caseIndex], opts = optionsPerCase[caseId], time = Math.round((Date.now() - startTime) / 1000), accuracy = selectedOption === opts.correct ? 100 : 40;
            responses.push({caseId, option: selectedOption, answer, time, accuracy});
            document.getElementById('answerCard').classList.remove('active');
            document.getElementById('feedbackCard').classList.add('active');
            const data = clinicalData[caseId];
            document.getElementById('aiInsights').innerHTML = data.insights.map(i => `<div class="insight-item"><div class="insight-title">${i.title}</div><div class="insight-detail">${i.detail}</div></div>`).join('');
            document.getElementById('teaching').textContent = data.teaching;
            document.getElementById('accuracyScore').textContent = accuracy + '%';
            document.getElementById('timeScore').textContent = time;
        }

        function resetAnswer() {
            document.getElementById('answerText').value = '';
            selectedOption = null;
            document.querySelectorAll('input[name="diagnosis"]').forEach(el => el.checked = false);
        }

        function nextCase() { caseIndex++; loadCase(); }
        function updateProgress() { document.getElementById('progressFill').style.width = ((caseIndex + 1) / maxCases) * 100 + '%'; }

        function toggleHeatmap() {
            showingHeatmap = !showingHeatmap;
            const canvas = document.getElementById('heatmapCanvas'), img = document.getElementById('cxrImage'), opacityControl = document.getElementById('opacityControl');
            if (showingHeatmap) {
                opacityControl.style.display = 'block';
                canvas.width = img.naturalWidth; canvas.height = img.naturalHeight;
                const ctx = canvas.getContext('2d'), grad = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, Math.max(canvas.width, canvas.height)/2);
                grad.addColorStop(0, 'rgba(255, 0, 0, 0.6)');
                grad.addColorStop(0.4, 'rgba(255, 165, 0, 0.4)');
                grad.addColorStop(0.7, 'rgba(0, 255, 255, 0.2)');
                grad.addColorStop(1, 'rgba(0, 0, 255, 0.1)');
                ctx.fillStyle = grad; ctx.fillRect(0, 0, canvas.width, canvas.height);
                canvas.style.display = 'block';
                canvas.style.width = img.offsetWidth + 'px';
                canvas.style.height = img.offsetHeight + 'px';
                document.getElementById('heatmapBtn').classList.add('active');
            } else {
                opacityControl.style.display = 'none';
                canvas.style.display = 'none';
                document.getElementById('heatmapBtn').classList.remove('active');
            }
        }

        function updateOpacity() { const opacity = document.getElementById('opacity').value; document.getElementById('opacityValue').textContent = opacity + '%'; document.getElementById('heatmapCanvas').style.opacity = opacity / 100; }
        function zoomIn() { zoomLevel = Math.min(zoomLevel + 0.2, 3); document.getElementById('cxrImage').style.transform = `scale(${zoomLevel})`; }
        function zoomOut() { zoomLevel = Math.max(zoomLevel - 0.2, 1); document.getElementById('cxrImage').style.transform = `scale(${zoomLevel})`; }
        function updateImage() { const b = document.getElementById('brightness').value; document.getElementById('cxrImage').style.filter = `brightness(${b}%)`; document.getElementById('brightnessValue').textContent = b + '%'; }

        function showSummary() {
            document.getElementById('questionCard').style.display = 'none';
            document.getElementById('answerCard').classList.remove('active');
            document.getElementById('feedbackCard').classList.remove('active');
            document.getElementById('summaryPanel').classList.add('active');
            const avg = responses.length > 0 ? Math.round(responses.reduce((s, r) => s + r.accuracy, 0) / responses.length) : 0, time = Math.round(responses.reduce((s, r) => s + r.time, 0) / 60);
            document.getElementById('totalCasesCompleted').textContent = responses.length;
            document.getElementById('avgAccuracy').textContent = avg + '%';
            document.getElementById('totalTime').textContent = time + ' Ø¯Ù‚ÛŒÙ‚Ù‡';
        }
    </script>
</body>
</html>